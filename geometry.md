# 개요

이 글에서는 점과 행렬과 점의 변환에 대해 다룬다.

# 기본

점 `(x, y, z)`는 1x3 행렬로 나타낼 수 있다.

```
[ x   y   z ]
```

높이가 3인 행렬만이 이 행렬과 곱해질 수 있다. 예를 들어 3x4 행렬은 이 행렬과 곱셈 연산이 가능하다.

```
                | c00  c01  c02  c03 |
[ x   y   z ] * | c10  c11  c12  c13 |
                | c20  c21  c22  c23 |

=  | a  b  c  d |

a = x * c00 + y * c10 + z * c20
b = x * c01 + y * c11 + z * c21
c = x * c02 + y * c12 + z * c22
d = x * c03 + y * c13 + z * c23
```

보통은 n차원 점(1xn 행렬)에 nxn 행렬을 곱하여 나온 1xn 행렬을 원래 점이 변환된 결과물로 여긴다. 행렬을 곱하는 행위를 일종의 함수로 사용하는 것이다. 이러한 성질을 사용해 여러 번의 변환을 연속적으로 가하는 것도 가능하다.

```
                | c00  c01  c02  |
[ x   y   z ] * | c10  c11  c12  |
                | c20  c21  c22  |

=  | x', y', z' |

x' = x * c00 + y * c10 + z * c20
y' = x * c01 + y * c11 + z * c21
z' = x * c02 + y * c12 + z * c22
```

실제로는 3차원 점을 다루더라도 4x4 행렬을 더 많이 사용한다. 그 이유는 다음에 적는다.

# 변환

## 항등 변환

단위행렬을 한 점에 곱해도 그 점의 좌표가 바뀌지 않는다.

```
              | 1  0  0 |
[ x  y  z ] * | 0  1  0 | = [ x  y  z ]
              | 0  0  1 |
```

## 크기 조절 (Scaling) 변환

어떤 점을 원점을 기준으로

- `x`축 방향으로 `Sx`배
- `y`축 방향으로 `Sy`배
- `z`축 방향으로 `Sz`배

거리를 멀게/가깝게 하고 싶을 시 이 변환을 사용한다.

```
              | Sx 0  0 |
[ x  y  z ] * | 0  Sy 0 | = [ Sx * x  Sy * y  Sz * z ]
              | 0  0  Sz|
```

한 개체를 이루는 점들에 일괄적으로 같은 크기 조절 변환을 가하면 그 개체가 축 방향으로 늘어나거나 줄어드는 효과가 있다.

## 회전 (Rotating) 변환

한 점을 한 좌표축을 기준으로 θ만큼 회전시키는 변환이다. 이때 회전 방향은 `x`, `y`, `z` 좌표축의 배열 방향에 따라 달라지는데, 여기서는 *오른손 방향*을 사용하도록 한다. 오른손으로 따봉을 만들었을 때 엄지손가락을 좌표축의 방향과 일치시킨다. 이때 나머지 손가락들이 휘감는 방향이 회전 변환의 방향이다.

```
        |  1        0        0      |
Rx(θ) = |  0        cos(θ)   sin(θ) |
        |  0       -sin(θ)   cos(θ) |

        |  cos(θ)   0       -sin(θ) |
Rx(θ) = |  0        1        0      |
        |  sin(θ)   0        cos(θ) |

        |  cos(θ)   sin(θ)   0      |
Rx(θ) = | -sin(θ)   cos(θ)   0      |
        |  0        0        1      |
```

여러 축 방향으로 복합적으로 회전시키려면 각 변환을 연속적으로 적용하면 된다.

## 평행 이동 (Translate) 변환

한 점에 임의의 변환을 적용한 결과는 다음과 같다.

```
                | c00  c01  c02  |
[ x   y   z ] * | c10  c11  c12  |
                | c20  c21  c22  |

=  | x', y', z' |

x' = x * c00 + y * c10 + z * c20
y' = x * c01 + y * c11 + z * c21
z' = x * c02 + y * c12 + z * c22
```

점을 평행 이동 시키기 위해서는 각 좌표별로 이동시킬 값을 더하면 된다. 각각 `Tx`, `Ty`, `Tz`만큼 이동시키기 위해서는 다음의 식을 구현해야 한다. 

```
x' = x * c00 + y * c10 + z * c20 + Tx
y' = x * c01 + y * c11 + z * c21 + Ty
z' = x * c02 + y * c12 + z * c22 + Tz
```

이는 4x3 행렬의 곱셈을 통해 구현해야 한다. 하지만 3차원 점을 다루는 상황에서 1x3 행렬과 4x3 행렬의 곱셈은 불가능하다. 이 상황에서는 언제나 1의 값을 가지는 하나의 좌표를 추가하여 마치 4차원 점을 다루는 것처럼 행렬 연산을 하는 것이 낫다. 추가로 여러 개의 변환을 연속적으로 하기 위해 행렬에도 하나의 행을 더 추가하여 4x4 행렬을 만든다. 이 행은 항상 `[ 0  0  0  1 ]`의 값을 가지며 연산 결과에 영향을 주지 않는다.

# 일반적 행렬 형태

```
                 | Xx  Xy  Xz  0 |  ->  x축
[ x  y  z  1 ] * | Yx  Yy  Yz  0 |  ->  y축
                 | Zx  Zy  Zz  0 |  ->  z축
                 | Tx  Ty  Tz  1 |  ->  이동

= [
	x * Xx + y * Yx + z * Zx + Tx,
    x * Xy + y * Yy + z * Zy + Ty,
	x * Xz + y * Yz + z * Zz + Tz,
	1
  ]

Xx, Yy, Zz: 크기 조절
Tx, Ty, Tz: (평행)이동
Xx, Xy, Xz, Yx, Yy, Yz, Zx, Zy, Zz: 회전
```

위 식은 `(x, y, z)`의 좌표를 가진 한 점이 만약 다음과 같은 성질을 좌표계에 있었다면 원래 좌표계 기준으로는 어느 좌표에 위치하는지 계산하는 식이다.

- 원점이 `(Tx, Ty, Tz)`
- x축의 벡터가 `(Xx, Xy, Xz)`
- y축의 벡터가 `(Yx, Yy, Yz)`
- z축의 벡터가 `(Zx, Zy, Zz)`

이 과정을 좌표계 변환이라고 하며 자세한 사항은 [투영법](projection.md)에서 다룬다.